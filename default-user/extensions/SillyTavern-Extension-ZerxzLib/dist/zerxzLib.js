import*as t from"../../../../../script.js";import*as e from"../../../../../scripts/openai.js";import*as n from"../../../../../scripts/popup.js";import*as s from"../../../../../scripts/secrets.js";import*as i from"../../../../../scripts/extensions.js";var o={d:(t,e)=>{for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};const r=(t=>{var e={};return o.d(e,t),e})({eventSource:()=>t.eventSource,event_types:()=>t.event_types,getRequestHeaders:()=>t.getRequestHeaders,saveSettingsDebounced:()=>t.saveSettingsDebounced});const a=(t=>{var e={};return o.d(e,t),e})({oai_settings:()=>e.oai_settings});const l=(t=>{var e={};return o.d(e,t),e})({POPUP_TYPE:()=>n.POPUP_TYPE,callGenericPopup:()=>n.callGenericPopup}),c="api_key_makersuite_custom",d={switchState:"true"===localStorage.getItem("switch_key_maker_suite"),throwGeminiErrorState:"true"!==localStorage.getItem("throw_gemini_error")};const h=(t=>{var e={};return o.d(e,t),e})({updateSecretDisplay:()=>s.updateSecretDisplay,writeSecret:()=>s.writeSecret});async function u(){const t=await fetch("/api/secrets/view",{method:"POST",headers:(0,r.getRequestHeaders)()});if(403===t.status)return void(0,l.callGenericPopup)("<h3>禁止访问</h3><p>要在此处查看您的 API 密钥，请在 config.yaml 文件中将 allowKeysExposure 的值设置为 true，然后重新启动 SillyTavern 服务器。</p>",l.POPUP_TYPE.TEXT);if(!t.ok)return;return await t.json()}async function p(){var t;const e=await u();if(!e)return;if(!d.switchState)return;const n=(null!==(t=e[c])&&void 0!==t?t:"").split(/[\n;]/).map((t=>t.trim())).filter((t=>t.startsWith("AIzaSy")));if(n.length<=1)return;const s=e.api_key_makersuite;let i="";n.includes(s)&&(n.splice(n.indexOf(s),1),n.push(s)),i=n[0],(0,h.writeSecret)("api_key_makersuite",i),g(c,n.join("\n"));const o=$("#api_key_makersuite_custom")[0],r=$("#current_key_maker_suite")[0],a=$("#last_key_maker_suite")[0];console.log("textarea",o),console.log("api_keys",n),o&&(r.textContent="当前密钥: ".concat(i),a.textContent="最后一个密钥: ".concat(s),o.value=n.join("\n"))}async function g(t,e){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];await(0,h.writeSecret)(t,e),n&&(0,h.updateSecretDisplay)(),(0,h.updateSecretDisplay)(),(0,r.saveSettingsDebounced)()}const m=["makersuite","aistudio"],f=()=>m.includes(a.oai_settings.chat_completion_source);function v(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";(0,l.callGenericPopup)("\n\t\t\t\t".concat(t,'\n\t\t\t\t<table class="responsiveTable">\n\t\t\t\t\t<thead>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<th>报错</th>\n\t\t\t\t\t\t\t<th>原因或解决方案</th>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</thead>\n\t\t\t\t\t<tbody>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>429/Resource has been exhausted</td>\n\t\t\t\t\t\t\t<td>撞到速率上限了，请等一会，若还是出现此报错请将最大上下文调整至 50k 以下</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>Internal Server Error</td>\n\t\t\t\t\t\t\t<td>手机端遇到请换成 clash，不要使用类如**VPN、** 加速器等第三方梯子软件，pc 端用户请打开服务模式和 tun 模式，若仍出现此报错需要检查一下反向代理-代理地址中是否留空，若有地址请删掉</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>User location is not supported for the API use.</td>\n\t\t\t\t\t\t\t<td>节点处于被限制的国家，请更换节点(美国最优先，请勿选择欧洲、中国香港、俄罗斯等地区)</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>Too Many Requests</td>\n\t\t\t\t\t\t\t<td>重刷过于频繁，等待一分钟，若无效则本日请求已达上限</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>Bad request</td>\n\t\t\t\t\t\t\t<td>网络环境出错或 API 已死（账号或项目被封禁）</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>API key expired. Please renew the API key</td>\n\t\t\t\t\t\t\t<td>API key 已过期或被删除</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>The model is overloaded. Please try later</td>\n\t\t\t\t\t\t\t<td>此模型暂时闭馆微调，暂停开放，请换用别的模型或等待一段时间</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>Please use a valid role: user, model.</td>\n\t\t\t\t\t\t\t<td>你使用了需要打补丁的预设，请换不需要补丁的预设或打补丁</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>User location is not supported for the API use without a billing account linked.</td>\n\t\t\t\t\t\t\t<td>处在 Google 政策限制免费层级的地区(如英国、意大利)</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>API key not valid. Please pass a valid API key</td>\n\t\t\t\t\t\t\t<td>API 返回错误，检查 API 是否可用</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>Permission denied: Consumer has been suspended.</td>\n\t\t\t\t\t\t\t<td>谷歌账号被封禁</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>MakerSuite API returned no candidate</td>\n\t\t\t\t\t\t\t<td>Prompt was blocked due to : OTHER 本次输出被截断，请关闭流式传输</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>Not Found</td>\n\t\t\t\t\t\t\t<td>模型选择错误，请不要选择除 Gemini 系外的模型或 Gemini Ultra</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>MakerSuite Candidate text empty</td>\n\t\t\t\t\t\t\t<td>还是截断，解决方法有很多，关闭一些全局世界书/更改输入内容/换版本更新一点的预设</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>403/Forbidden</td>\n\t\t\t\t\t\t\t<td>账号或项目被封禁，API key 无法调用</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</tbody>\n\t\t\t\t</table>\n\t\t\t'),l.POPUP_TYPE.TEXT,"",{large:!0,wide:!0,allowVerticalScrolling:!0})}async function y(){var t,e;let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!n)return;const s=JSON.parse(null!==(t=n.models_makersuite)&&void 0!==t?t:"[]"),i=null!==(e=n.api_key_makersuite)&&void 0!==e?e:"";console.log("ZerxzLib init");const o=$("#model_google_select > optgroup");console.log("optgroup",o);const r=o[0],l=o[1];console.log("subVersions",l);const c=Array.from(l.children),d=Array.from(r.children);console.log("subVersionsArray",c);const h=c.map((t=>t.value)),u=[...d.map((t=>t.value)),...h].flat(),p=s.map((t=>t.model));if(s.length>0)for(const t of s){if(u.includes(t.model))continue;const e=document.createElement("option");e.value=t.model,e.text="".concat(t.name,"(").concat(t.model,")"),l.appendChild(e)}const m=await async function(t){try{const e=await fetch("https://generativelanguage.googleapis.com/v1beta/models/?key=".concat(t)),n=await e.json();return null!=n&&n.models?(console.log(n),n.models.filter((t=>t.name.includes("gemini"))).map((t=>{const e=t.name.replace("models/","");return{name:t.displayName,model:e}}))):[]}catch(t){return console.error(t),[]}}(i);console.log("geminiModels",m);const v=m.filter((t=>!u.includes(t.model)&&!p.includes(t.model)));if(0===v.length)console.log("没有新的模型");else{console.log("geminiModelOptions",v);for(const t of v){const e=document.createElement("option");e.value=t.model,e.text="".concat(t.name,"(").concat(t.model,")"),l.appendChild(e)}g("models_makersuite",JSON.stringify(v))}const y=new Set([...u,...p,...v.map((t=>t.model))]);if(f()&&n.api_key_makersuite_model){if(!y.has(n.api_key_makersuite_model))return;a.oai_settings.google_model=n.api_key_makersuite_model,$("#model_google_select").val(a.oai_settings.google_model),$('#model_google_select option[value="'.concat(a.oai_settings.google_model,'"')).attr("selected",!0)}}const b=toastr.error;
/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const _=globalThis,S=_.ShadowRoot&&(void 0===_.ShadyCSS||_.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,w=Symbol(),A=new WeakMap;class x{constructor(t,e,n){if(this._$cssResult$=!0,n!==w)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t,this.t=e}get styleSheet(){let t=this.o;const e=this.t;if(S&&void 0===t){const n=void 0!==e&&1===e.length;n&&(t=A.get(e)),void 0===t&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),n&&A.set(e,t))}return t}toString(){return this.cssText}}const E=S?t=>t:t=>t instanceof CSSStyleSheet?(t=>{let e="";for(const n of t.cssRules)e+=n.cssText;return(t=>new x("string"==typeof t?t:t+"",void 0,w))(e)})(t):t,{is:C,defineProperty:k,getOwnPropertyDescriptor:P,getOwnPropertyNames:T,getOwnPropertySymbols:N,getPrototypeOf:O}=Object,I=globalThis,M=I.trustedTypes,j=M?M.emptyScript:"",R=I.reactiveElementPolyfillSupport,L=(t,e)=>t,D={toAttribute(t,e){switch(e){case Boolean:t=t?j:null;break;case Object:case Array:t=null==t?t:JSON.stringify(t)}return t},fromAttribute(t,e){let n=t;switch(e){case Boolean:n=null!==t;break;case Number:n=null===t?null:Number(t);break;case Object:case Array:try{n=JSON.parse(t)}catch(t){n=null}}return n}},U=(t,e)=>!C(t,e),H={attribute:!0,type:String,converter:D,reflect:!1,hasChanged:U};Symbol.metadata??=Symbol("metadata"),I.litPropertyMetadata??=new WeakMap;class W extends HTMLElement{static addInitializer(t){this._$Ei(),(this.l??=[]).push(t)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(t,e=H){if(e.state&&(e.attribute=!1),this._$Ei(),this.elementProperties.set(t,e),!e.noAccessor){const n=Symbol(),s=this.getPropertyDescriptor(t,n,e);void 0!==s&&k(this.prototype,t,s)}}static getPropertyDescriptor(t,e,n){const{get:s,set:i}=P(this.prototype,t)??{get(){return this[e]},set(t){this[e]=t}};return{get(){return s?.call(this)},set(e){const o=s?.call(this);i.call(this,e),this.requestUpdate(t,o,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)??H}static _$Ei(){if(this.hasOwnProperty(L("elementProperties")))return;const t=O(this);t.finalize(),void 0!==t.l&&(this.l=[...t.l]),this.elementProperties=new Map(t.elementProperties)}static finalize(){if(this.hasOwnProperty(L("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(L("properties"))){const t=this.properties,e=[...T(t),...N(t)];for(const n of e)this.createProperty(n,t[n])}const t=this[Symbol.metadata];if(null!==t){const e=litPropertyMetadata.get(t);if(void 0!==e)for(const[t,n]of e)this.elementProperties.set(t,n)}this._$Eh=new Map;for(const[t,e]of this.elementProperties){const n=this._$Eu(t,e);void 0!==n&&this._$Eh.set(n,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(t){const e=[];if(Array.isArray(t)){const n=new Set(t.flat(1/0).reverse());for(const t of n)e.unshift(E(t))}else void 0!==t&&e.push(E(t));return e}static _$Eu(t,e){const n=e.attribute;return!1===n?void 0:"string"==typeof n?n:"string"==typeof t?t.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise((t=>this.enableUpdating=t)),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach((t=>t(this)))}addController(t){(this._$EO??=new Set).add(t),void 0!==this.renderRoot&&this.isConnected&&t.hostConnected?.()}removeController(t){this._$EO?.delete(t)}_$E_(){const t=new Map,e=this.constructor.elementProperties;for(const n of e.keys())this.hasOwnProperty(n)&&(t.set(n,this[n]),delete this[n]);t.size>0&&(this._$Ep=t)}createRenderRoot(){const t=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return((t,e)=>{if(S)t.adoptedStyleSheets=e.map((t=>t instanceof CSSStyleSheet?t:t.styleSheet));else for(const n of e){const e=document.createElement("style"),s=_.litNonce;void 0!==s&&e.setAttribute("nonce",s),e.textContent=n.cssText,t.appendChild(e)}})(t,this.constructor.elementStyles),t}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach((t=>t.hostConnected?.()))}enableUpdating(t){}disconnectedCallback(){this._$EO?.forEach((t=>t.hostDisconnected?.()))}attributeChangedCallback(t,e,n){this._$AK(t,n)}_$EC(t,e){const n=this.constructor.elementProperties.get(t),s=this.constructor._$Eu(t,n);if(void 0!==s&&!0===n.reflect){const i=(void 0!==n.converter?.toAttribute?n.converter:D).toAttribute(e,n.type);this._$Em=t,null==i?this.removeAttribute(s):this.setAttribute(s,i),this._$Em=null}}_$AK(t,e){const n=this.constructor,s=n._$Eh.get(t);if(void 0!==s&&this._$Em!==s){const t=n.getPropertyOptions(s),i="function"==typeof t.converter?{fromAttribute:t.converter}:void 0!==t.converter?.fromAttribute?t.converter:D;this._$Em=s,this[s]=i.fromAttribute(e,t.type),this._$Em=null}}requestUpdate(t,e,n){if(void 0!==t){if(n??=this.constructor.getPropertyOptions(t),!(n.hasChanged??U)(this[t],e))return;this.P(t,e,n)}!1===this.isUpdatePending&&(this._$ES=this._$ET())}P(t,e,n){this._$AL.has(t)||this._$AL.set(t,e),!0===n.reflect&&this._$Em!==t&&(this._$Ej??=new Set).add(t)}async _$ET(){this.isUpdatePending=!0;try{await this._$ES}catch(t){Promise.reject(t)}const t=this.scheduleUpdate();return null!=t&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[t,e]of this._$Ep)this[t]=e;this._$Ep=void 0}const t=this.constructor.elementProperties;if(t.size>0)for(const[e,n]of t)!0!==n.wrapped||this._$AL.has(e)||void 0===this[e]||this.P(e,this[e],n)}let t=!1;const e=this._$AL;try{t=this.shouldUpdate(e),t?(this.willUpdate(e),this._$EO?.forEach((t=>t.hostUpdate?.())),this.update(e)):this._$EU()}catch(e){throw t=!1,this._$EU(),e}t&&this._$AE(e)}willUpdate(t){}_$AE(t){this._$EO?.forEach((t=>t.hostUpdated?.())),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$EU(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(t){return!0}update(t){this._$Ej&&=this._$Ej.forEach((t=>this._$EC(t,this[t]))),this._$EU()}updated(t){}firstUpdated(t){}}W.elementStyles=[],W.shadowRootOptions={mode:"open"},W[L("elementProperties")]=new Map,W[L("finalized")]=new Map,R?.({ReactiveElement:W}),(I.reactiveElementVersions??=[]).push("2.0.4");
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const q=globalThis,z=q.trustedTypes,B=z?z.createPolicy("lit-html",{createHTML:t=>t}):void 0,G="$lit$",K=`lit$${Math.random().toFixed(9).slice(2)}$`,V="?"+K,Y=`<${V}>`,F=document,Q=()=>F.createComment(""),J=t=>null===t||"object"!=typeof t&&"function"!=typeof t,Z=Array.isArray,X=t=>Z(t)||"function"==typeof t?.[Symbol.iterator],tt="[ \t\n\f\r]",et=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,nt=/-->/g,st=/>/g,it=RegExp(`>|${tt}(?:([^\\s"'>=/]+)(${tt}*=${tt}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),ot=/'/g,rt=/"/g,at=/^(?:script|style|textarea|title)$/i,lt=t=>(e,...n)=>({_$litType$:t,strings:e,values:n}),ct=lt(1),dt=lt(2),ht=(lt(3),Symbol.for("lit-noChange")),ut=Symbol.for("lit-nothing"),pt=new WeakMap,gt=F.createTreeWalker(F,129);function mt(t,e){if(!Z(t)||!t.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==B?B.createHTML(e):e}const ft=(t,e)=>{const n=t.length-1,s=[];let i,o=2===e?"<svg>":3===e?"<math>":"",r=et;for(let e=0;e<n;e++){const n=t[e];let a,l,c=-1,d=0;for(;d<n.length&&(r.lastIndex=d,l=r.exec(n),null!==l);)d=r.lastIndex,r===et?"!--"===l[1]?r=nt:void 0!==l[1]?r=st:void 0!==l[2]?(at.test(l[2])&&(i=RegExp("</"+l[2],"g")),r=it):void 0!==l[3]&&(r=it):r===it?">"===l[0]?(r=i??et,c=-1):void 0===l[1]?c=-2:(c=r.lastIndex-l[2].length,a=l[1],r=void 0===l[3]?it:'"'===l[3]?rt:ot):r===rt||r===ot?r=it:r===nt||r===st?r=et:(r=it,i=void 0);const h=r===it&&t[e+1].startsWith("/>")?" ":"";o+=r===et?n+Y:c>=0?(s.push(a),n.slice(0,c)+G+n.slice(c)+K+h):n+K+(-2===c?e:h)}return[mt(t,o+(t[n]||"<?>")+(2===e?"</svg>":3===e?"</math>":"")),s]};class vt{constructor({strings:t,_$litType$:e},n){let s;this.parts=[];let i=0,o=0;const r=t.length-1,a=this.parts,[l,c]=ft(t,e);if(this.el=vt.createElement(l,n),gt.currentNode=this.el.content,2===e||3===e){const t=this.el.content.firstChild;t.replaceWith(...t.childNodes)}for(;null!==(s=gt.nextNode())&&a.length<r;){if(1===s.nodeType){if(s.hasAttributes())for(const t of s.getAttributeNames())if(t.endsWith(G)){const e=c[o++],n=s.getAttribute(t).split(K),r=/([.?@])?(.*)/.exec(e);a.push({type:1,index:i,name:r[2],strings:n,ctor:"."===r[1]?wt:"?"===r[1]?$t:"@"===r[1]?At:St}),s.removeAttribute(t)}else t.startsWith(K)&&(a.push({type:6,index:i}),s.removeAttribute(t));if(at.test(s.tagName)){const t=s.textContent.split(K),e=t.length-1;if(e>0){s.textContent=z?z.emptyScript:"";for(let n=0;n<e;n++)s.append(t[n],Q()),gt.nextNode(),a.push({type:2,index:++i});s.append(t[e],Q())}}}else if(8===s.nodeType)if(s.data===V)a.push({type:2,index:i});else{let t=-1;for(;-1!==(t=s.data.indexOf(K,t+1));)a.push({type:7,index:i}),t+=K.length-1}i++}}static createElement(t,e){const n=F.createElement("template");return n.innerHTML=t,n}}function yt(t,e,n=t,s){if(e===ht)return e;let i=void 0!==s?n._$Co?.[s]:n._$Cl;const o=J(e)?void 0:e._$litDirective$;return i?.constructor!==o&&(i?._$AO?.(!1),void 0===o?i=void 0:(i=new o(t),i._$AT(t,n,s)),void 0!==s?(n._$Co??=[])[s]=i:n._$Cl=i),void 0!==i&&(e=yt(t,i._$AS(t,e.values),i,s)),e}class bt{constructor(t,e){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){const{el:{content:e},parts:n}=this._$AD,s=(t?.creationScope??F).importNode(e,!0);gt.currentNode=s;let i=gt.nextNode(),o=0,r=0,a=n[0];for(;void 0!==a;){if(o===a.index){let e;2===a.type?e=new _t(i,i.nextSibling,this,t):1===a.type?e=new a.ctor(i,a.name,a.strings,this,t):6===a.type&&(e=new xt(i,this,t)),this._$AV.push(e),a=n[++r]}o!==a?.index&&(i=gt.nextNode(),o++)}return gt.currentNode=F,s}p(t){let e=0;for(const n of this._$AV)void 0!==n&&(void 0!==n.strings?(n._$AI(t,n,e),e+=n.strings.length-2):n._$AI(t[e])),e++}}class _t{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(t,e,n,s){this.type=2,this._$AH=ut,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=n,this.options=s,this._$Cv=s?.isConnected??!0}get parentNode(){let t=this._$AA.parentNode;const e=this._$AM;return void 0!==e&&11===t?.nodeType&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=yt(this,t,e),J(t)?t===ut||null==t||""===t?(this._$AH!==ut&&this._$AR(),this._$AH=ut):t!==this._$AH&&t!==ht&&this._(t):void 0!==t._$litType$?this.$(t):void 0!==t.nodeType?this.T(t):X(t)?this.k(t):this._(t)}O(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}_(t){this._$AH!==ut&&J(this._$AH)?this._$AA.nextSibling.data=t:this.T(F.createTextNode(t)),this._$AH=t}$(t){const{values:e,_$litType$:n}=t,s="number"==typeof n?this._$AC(t):(void 0===n.el&&(n.el=vt.createElement(mt(n.h,n.h[0]),this.options)),n);if(this._$AH?._$AD===s)this._$AH.p(e);else{const t=new bt(s,this),n=t.u(this.options);t.p(e),this.T(n),this._$AH=t}}_$AC(t){let e=pt.get(t.strings);return void 0===e&&pt.set(t.strings,e=new vt(t)),e}k(t){Z(this._$AH)||(this._$AH=[],this._$AR());const e=this._$AH;let n,s=0;for(const i of t)s===e.length?e.push(n=new _t(this.O(Q()),this.O(Q()),this,this.options)):n=e[s],n._$AI(i),s++;s<e.length&&(this._$AR(n&&n._$AB.nextSibling,s),e.length=s)}_$AR(t=this._$AA.nextSibling,e){for(this._$AP?.(!1,!0,e);t&&t!==this._$AB;){const e=t.nextSibling;t.remove(),t=e}}setConnected(t){void 0===this._$AM&&(this._$Cv=t,this._$AP?.(t))}}class St{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,e,n,s,i){this.type=1,this._$AH=ut,this._$AN=void 0,this.element=t,this.name=e,this._$AM=s,this.options=i,n.length>2||""!==n[0]||""!==n[1]?(this._$AH=Array(n.length-1).fill(new String),this.strings=n):this._$AH=ut}_$AI(t,e=this,n,s){const i=this.strings;let o=!1;if(void 0===i)t=yt(this,t,e,0),o=!J(t)||t!==this._$AH&&t!==ht,o&&(this._$AH=t);else{const s=t;let r,a;for(t=i[0],r=0;r<i.length-1;r++)a=yt(this,s[n+r],e,r),a===ht&&(a=this._$AH[r]),o||=!J(a)||a!==this._$AH[r],a===ut?t=ut:t!==ut&&(t+=(a??"")+i[r+1]),this._$AH[r]=a}o&&!s&&this.j(t)}j(t){t===ut?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}}class wt extends St{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===ut?void 0:t}}class $t extends St{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==ut)}}class At extends St{constructor(t,e,n,s,i){super(t,e,n,s,i),this.type=5}_$AI(t,e=this){if((t=yt(this,t,e,0)??ut)===ht)return;const n=this._$AH,s=t===ut&&n!==ut||t.capture!==n.capture||t.once!==n.once||t.passive!==n.passive,i=t!==ut&&(n===ut||s);s&&this.element.removeEventListener(this.name,this,n),i&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){"function"==typeof this._$AH?this._$AH.call(this.options?.host??this.element,t):this._$AH.handleEvent(t)}}class xt{constructor(t,e,n){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=n}get _$AU(){return this._$AM._$AU}_$AI(t){yt(this,t)}}const Et={M:G,P:K,A:V,C:1,L:ft,R:bt,D:X,V:yt,I:_t,H:St,N:$t,U:At,B:wt,F:xt},Ct=q.litHtmlPolyfillSupport;Ct?.(vt,_t),(q.litHtmlVersions??=[]).push("3.2.1");
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
class kt extends W{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const t=super.createRenderRoot();return this.renderOptions.renderBefore??=t.firstChild,t}update(t){const e=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=((t,e,n)=>{const s=n?.renderBefore??e;let i=s._$litPart$;if(void 0===i){const t=n?.renderBefore??null;s._$litPart$=i=new _t(e.insertBefore(Q(),t),t,void 0,n??{})}return i._$AI(t),i})(e,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return ht}}kt._$litElement$=!0,kt.finalized=!0,globalThis.litElementHydrateSupport?.({LitElement:kt});const Pt=globalThis.litElementPolyfillSupport;Pt?.({LitElement:kt});(globalThis.litElementVersions??=[]).push("4.1.1");
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const Tt=1,Nt=2,Ot=t=>(...e)=>({_$litDirective$:t,values:e});class It{constructor(t){}get _$AU(){return this._$AM._$AU}_$AT(t,e,n){this._$Ct=t,this._$AM=e,this._$Ci=n}_$AS(t,e){return this.update(t,e)}update(t,e){return this.render(...e)}}
/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const{I:Mt}=Et,jt=()=>document.createComment(""),Rt=(t,e,n)=>{const s=t._$AA.parentNode,i=void 0===e?t._$AB:e._$AA;if(void 0===n){const e=s.insertBefore(jt(),i),o=s.insertBefore(jt(),i);n=new Mt(e,o,t,t.options)}else{const e=n._$AB.nextSibling,o=n._$AM,r=o!==t;if(r){let e;n._$AQ?.(t),n._$AM=t,void 0!==n._$AP&&(e=t._$AU)!==o._$AU&&n._$AP(e)}if(e!==i||r){let t=n._$AA;for(;t!==e;){const e=t.nextSibling;s.insertBefore(t,i),t=e}}}return n},Lt=(t,e,n=t)=>(t._$AI(e,n),t),Dt={},Ut=t=>{t._$AP?.(!1,!0);let e=t._$AA;const n=t._$AB.nextSibling;for(;e!==n;){const t=e.nextSibling;e.remove(),e=t}},Ht=(t,e,n)=>{const s=new Map;for(let i=e;i<=n;i++)s.set(t[i],i);return s},Wt=Ot(class extends It{constructor(t){if(super(t),t.type!==Nt)throw Error("repeat() can only be used in text expressions")}dt(t,e,n){let s;void 0===n?n=e:void 0!==e&&(s=e);const i=[],o=[];let r=0;for(const e of t)i[r]=s?s(e,r):r,o[r]=n(e,r),r++;return{values:o,keys:i}}render(t,e,n){return this.dt(t,e,n).values}update(t,[e,n,s]){const i=(t=>t._$AH)(t),{values:o,keys:r}=this.dt(e,n,s);if(!Array.isArray(i))return this.ut=r,o;const a=this.ut??=[],l=[];let c,d,h=0,u=i.length-1,p=0,g=o.length-1;for(;h<=u&&p<=g;)if(null===i[h])h++;else if(null===i[u])u--;else if(a[h]===r[p])l[p]=Lt(i[h],o[p]),h++,p++;else if(a[u]===r[g])l[g]=Lt(i[u],o[g]),u--,g--;else if(a[h]===r[g])l[g]=Lt(i[h],o[g]),Rt(t,l[g+1],i[h]),h++,g--;else if(a[u]===r[p])l[p]=Lt(i[u],o[p]),Rt(t,i[h],i[u]),u--,p++;else if(void 0===c&&(c=Ht(r,p,g),d=Ht(a,h,u)),c.has(a[h]))if(c.has(a[u])){const e=d.get(r[p]),n=void 0!==e?i[e]:null;if(null===n){const e=Rt(t,i[h]);Lt(e,o[p]),l[p]=e}else l[p]=Lt(n,o[p]),Rt(t,i[h],n),i[e]=null;p++}else Ut(i[u]),u--;else Ut(i[h]),h++;for(;p<=g;){const e=Rt(t,l[g+1]);Lt(e,o[p]),l[p++]=e}for(;h<=u;){const t=i[h++];null!==t&&Ut(t)}return this.ut=r,((t,e=Dt)=>{t._$AH=e})(t,l),ht}});var qt,zt;function Bt(t,e){return e||(e=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}class Gt extends kt{constructor(){super(),this.currentKey="",this.lastKey="",this.throwGeminiErrorState=!1,this.switchKeyMakerSuite=!1,this.apiKeys=""}createRenderRoot(){return this}render(){console.log("GeminiLayouts render"),console.log("this",this);const t=[{name:"保存密钥",handle:this.handleSaveKey},{name:"获取新的模型",handle:this.handleGetNewModel},{name:"切换密钥设置",handle:this.handleSwitchKeyMakerSuite},{name:"查看报错原因",handle:this.handleThrowGeminiError},{name:"报错开关",handle:this.handleSwitchGeminiError}];return ct(qt||(qt=Bt(['\n        <div>\n            <h4>密钥调用信息:</h4>\n            <div id="current_key_maker_suite">当前: ','</div>\n            <div id="last_key_maker_suite">最后: ','</div>\n            <div id="switch_key_maker_suite">密钥切换:','</div>\n            <div id="throw_gemini_error">报错开关:','</div>\n        </div>\n        <div class="flex-container flex">\n            <h4>Google AI Studio API 多个密钥</h4>\n            <textarea class="text_pole textarea_compact autoSetHeight" placeholder="API密钥"\n            id="api_key_makersuite_custom" style="height: 100px;" @change='," .value=",'></textarea>\n        </div>\n        <div class="flex-container flex">\n        ',"\n        </div>\n        <hr>\n        "])),this.currentKey,this.lastKey,this.switchKeyMakerSuite?"开":"关",this.throwGeminiErrorState?"开":"关",this.handleTextareaInput,this.apiKeys,Wt(t,(t=>{let{name:e}=t;return e}),(t=>{let{name:e,handle:n}=t;return ct(zt||(zt=Bt(['\n                                    <div class="menu_button menu_button_icon interactable" title="','" @click="','"><span>',"</span></div>"])),e,n,e)})))}handleTextareaInput(t){console.log("handleTextareaInput",t);const e=t.target,n=e.value.split(/[\n;]/).map((t=>t.trim())).filter((t=>t.length>0&&t.startsWith("AIzaSy")));if(this.apiKeys=n.join("\n"),e.value=this.apiKeys,0===n.length)return void g(c,this.apiKeys);const s=n[0];(0,h.writeSecret)("api_key_makersuite",s),g(c,this.apiKeys)}handleThrowGeminiError(){console.log("handleThrowGeminiError"),v()}async handleGetNewModel(){console.log("handleGetNewModel");const t=await u();await y(t)}handleSaveKey(){console.log("handleSaveKey");const t=this.apiKeys;if(0===t.length)return void g(c,t);const e=t[0];(0,h.writeSecret)("api_key_makersuite",e),g(c,this.apiKeys)}handleSwitchKeyMakerSuite(){console.log("handleSwitchKeyMakerSuite"),d.switchState=!d.switchState,localStorage.setItem("switch_key_maker_suite",d.switchState.toString()),this.switchKeyMakerSuite=d.switchState}handleSwitchGeminiError(){console.log("handleSwitchGeminiError"),d.throwGeminiErrorState=!d.throwGeminiErrorState,localStorage.setItem("throw_gemini_error",d.throwGeminiErrorState.toString()),this.throwGeminiErrorState=d.throwGeminiErrorState}}!function(t,e,n){(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var s=n.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}(Gt,"properties",{currentKey:{type:String,reflect:!0},lastKey:{type:String,reflect:!0},throwGeminiErrorState:{type:Boolean,reflect:!0},switchKeyMakerSuite:{type:Boolean,reflect:!0},apiKeys:{type:String,reflect:!0}}),customElements.define("gemini-layouts",Gt);
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const Kt=(t,e)=>{const n=t._$AN;if(void 0===n)return!1;for(const t of n)t._$AO?.(e,!1),Kt(t,e);return!0},Vt=t=>{let e,n;do{if(void 0===(e=t._$AM))break;n=e._$AN,n.delete(t),t=e}while(0===n?.size)},Yt=t=>{for(let e;e=t._$AM;t=e){let n=e._$AN;if(void 0===n)e._$AN=n=new Set;else if(n.has(t))break;n.add(t),Jt(e)}};function Ft(t){void 0!==this._$AN?(Vt(this),this._$AM=t,Yt(this)):this._$AM=t}function Qt(t,e=!1,n=0){const s=this._$AH,i=this._$AN;if(void 0!==i&&0!==i.size)if(e)if(Array.isArray(s))for(let t=n;t<s.length;t++)Kt(s[t],!1),Vt(s[t]);else null!=s&&(Kt(s,!1),Vt(s));else Kt(this,t)}const Jt=t=>{t.type==Nt&&(t._$AP??=Qt,t._$AQ??=Ft)};class Zt extends It{constructor(){super(...arguments),this._$AN=void 0}_$AT(t,e,n){super._$AT(t,e,n),Yt(this),this.isConnected=t._$AU}_$AO(t,e=!0){t!==this.isConnected&&(this.isConnected=t,t?this.reconnected?.():this.disconnected?.()),e&&(Kt(this,t),Vt(this))}setValue(t){if((t=>void 0===t.strings)(this._$Ct))this._$Ct._$AI(t,this);else{const e=[...this._$Ct._$AH];e[this._$Ci]=t,this._$Ct._$AI(e,this,0)}}disconnected(){}reconnected(){}}
/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const Xt=()=>new te;class te{}const ee=new WeakMap,ne=Ot(class extends Zt{render(t){return ut}update(t,[e]){const n=e!==this.Y;return n&&void 0!==this.Y&&this.rt(void 0),(n||this.lt!==this.ct)&&(this.Y=e,this.ht=t.options?.host,this.rt(this.ct=t.element)),ut}rt(t){if(this.isConnected||(t=void 0),"function"==typeof this.Y){const e=this.ht??globalThis;let n=ee.get(e);void 0===n&&(n=new WeakMap,ee.set(e,n)),void 0!==n.get(this.Y)&&this.Y.call(this.ht,void 0),n.set(this.Y,t),void 0!==t&&this.Y.call(this.ht,t)}else this.Y.value=t}get lt(){return"function"==typeof this.Y?ee.get(this.ht??globalThis)?.get(this.Y):this.Y?.value}disconnected(){this.lt===this.ct&&this.rt(void 0)}reconnected(){this.rt(this.ct)}});var se=Object.defineProperty,ie=(t,e,n)=>(((t,e,n)=>{e in t?se(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n),oe=(t,e)=>{if(Object(e)!==e)throw TypeError('Cannot use the "in" operator on this value');return t.has(e)},re=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},ae=(t,e,n)=>(((t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)})(t,e,"access private method"),n);
/**
 * @license
 * Copyright Google LLC All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */
function le(t,e){return Object.is(t,e)}
/**
 * @license
 * Copyright Google LLC All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */let ce=null,de=!1,he=1;const ue=Symbol("SIGNAL");function pe(t){const e=ce;return ce=t,e}const ge={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function me(t){if(de)throw new Error("undefined"!=typeof ngDevMode&&ngDevMode?"Assertion error: signal read during notification phase":"");if(null===ce)return;ce.consumerOnSignalRead(t);const e=ce.nextProducerIndex++;if(we(ce),e<ce.producerNode.length&&ce.producerNode[e]!==t&&Se(ce)){_e(ce.producerNode[e],ce.producerIndexOfThis[e])}ce.producerNode[e]!==t&&(ce.producerNode[e]=t,ce.producerIndexOfThis[e]=Se(ce)?be(t,ce,e):0),ce.producerLastReadVersion[e]=t.version}function fe(t){if(t.dirty||t.lastCleanEpoch!==he){if(!t.producerMustRecompute(t)&&!function(t){we(t);for(let e=0;e<t.producerNode.length;e++){const n=t.producerNode[e],s=t.producerLastReadVersion[e];if(s!==n.version)return!0;if(fe(n),s!==n.version)return!0}return!1}(t))return t.dirty=!1,void(t.lastCleanEpoch=he);t.producerRecomputeValue(t),t.dirty=!1,t.lastCleanEpoch=he}}function ve(t){if(void 0===t.liveConsumerNode)return;const e=de;de=!0;try{for(const e of t.liveConsumerNode)e.dirty||ye(e)}finally{de=e}}function ye(t){var e;t.dirty=!0,ve(t),null==(e=t.consumerMarkedDirty)||e.call(t.wrapper??t)}function be(t,e,n){var s;if($e(t),we(t),0===t.liveConsumerNode.length){null==(s=t.watched)||s.call(t.wrapper);for(let e=0;e<t.producerNode.length;e++)t.producerIndexOfThis[e]=be(t.producerNode[e],t,e)}return t.liveConsumerIndexOfThis.push(n),t.liveConsumerNode.push(e)-1}function _e(t,e){var n;if($e(t),we(t),"undefined"!=typeof ngDevMode&&ngDevMode&&e>=t.liveConsumerNode.length)throw new Error(`Assertion error: active consumer index ${e} is out of bounds of ${t.liveConsumerNode.length} consumers)`);if(1===t.liveConsumerNode.length){null==(n=t.unwatched)||n.call(t.wrapper);for(let e=0;e<t.producerNode.length;e++)_e(t.producerNode[e],t.producerIndexOfThis[e])}const s=t.liveConsumerNode.length-1;if(t.liveConsumerNode[e]=t.liveConsumerNode[s],t.liveConsumerIndexOfThis[e]=t.liveConsumerIndexOfThis[s],t.liveConsumerNode.length--,t.liveConsumerIndexOfThis.length--,e<t.liveConsumerNode.length){const n=t.liveConsumerIndexOfThis[e],s=t.liveConsumerNode[e];we(s),s.producerIndexOfThis[n]=e}}function Se(t){var e;return t.consumerIsAlwaysLive||((null==(e=null==t?void 0:t.liveConsumerNode)?void 0:e.length)??0)>0}function we(t){t.producerNode??(t.producerNode=[]),t.producerIndexOfThis??(t.producerIndexOfThis=[]),t.producerLastReadVersion??(t.producerLastReadVersion=[])}function $e(t){t.liveConsumerNode??(t.liveConsumerNode=[]),t.liveConsumerIndexOfThis??(t.liveConsumerIndexOfThis=[])}
/**
 * @license
 * Copyright Google LLC All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */function Ae(t){if(fe(t),me(t),t.value===Ce)throw t.error;return t.value}const xe=Symbol("UNSET"),Ee=Symbol("COMPUTING"),Ce=Symbol("ERRORED"),ke=(()=>({...ge,value:xe,dirty:!0,error:null,equal:le,producerMustRecompute:t=>t.value===xe||t.value===Ee,producerRecomputeValue(t){if(t.value===Ee)throw new Error("Detected cycle in computations.");const e=t.value;t.value=Ee;const n=function(t){return t&&(t.nextProducerIndex=0),pe(t)}(t);let s,i=!1;try{s=t.computation.call(t.wrapper);i=e!==xe&&e!==Ce&&t.equal.call(t.wrapper,e,s)}catch(e){s=Ce,t.error=e}finally{!function(t,e){if(pe(e),t&&void 0!==t.producerNode&&void 0!==t.producerIndexOfThis&&void 0!==t.producerLastReadVersion){if(Se(t))for(let e=t.nextProducerIndex;e<t.producerNode.length;e++)_e(t.producerNode[e],t.producerIndexOfThis[e]);for(;t.producerNode.length>t.nextProducerIndex;)t.producerNode.pop(),t.producerLastReadVersion.pop(),t.producerIndexOfThis.pop()}}(t,n)}i?t.value=e:(t.value=s,t.version++)}}))();let Pe=
/**
 * @license
 * Copyright Google LLC All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */
function(){throw new Error};function Te(){return me(this),this.value}function Ne(t,e){!1===(null==ce?void 0:ce.consumerAllowSignalWrites)&&Pe(),t.equal.call(t.wrapper,t.value,e)||(t.value=e,function(t){t.version++,he++,ve(t)}
/**
 * @license
 * Copyright 2024 Bloomberg Finance L.P.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t))}const Oe=(()=>({...ge,equal:le,value:void 0}))();const Ie=Symbol("node");var Me;(t=>{var e,n,s,i;e=Ie,n=new WeakSet,t.isState=t=>oe(n,t),t.State=class{constructor(s,i={}){re(this,n),ie(this,e);const o=
/**
 * @license
 * Copyright Google LLC All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */
function(t){const e=Object.create(Oe);e.value=t;const n=()=>(me(e),e.value);return n[ue]=e,n}(s),r=o[ue];if(this[Ie]=r,r.wrapper=this,i){const e=i.equals;e&&(r.equal=e),r.watched=i[t.subtle.watched],r.unwatched=i[t.subtle.unwatched]}}get(){if(!(0,t.isState)(this))throw new TypeError("Wrong receiver type for Signal.State.prototype.get");return Te.call(this[Ie])}set(e){if(!(0,t.isState)(this))throw new TypeError("Wrong receiver type for Signal.State.prototype.set");if(de)throw new Error("Writes to signals not permitted during Watcher callback");Ne(this[Ie],e)}};s=Ie,i=new WeakSet,t.isComputed=t=>oe(i,t),t.Computed=class{constructor(e,n){re(this,i),ie(this,s);const o=function(t){const e=Object.create(ke);e.computation=t;const n=()=>Ae(e);return n[ue]=e,n}(e),r=o[ue];if(r.consumerAllowSignalWrites=!0,this[Ie]=r,r.wrapper=this,n){const e=n.equals;e&&(r.equal=e),r.watched=n[t.subtle.watched],r.unwatched=n[t.subtle.unwatched]}}get(){if(!(0,t.isComputed)(this))throw new TypeError("Wrong receiver type for Signal.Computed.prototype.get");return Ae(this[Ie])}},(e=>{var n,s,i,o;e.untrack=function(t){let e,n=null;try{n=pe(null),e=t()}finally{pe(n)}return e},e.introspectSources=function(e){var n;if(!(0,t.isComputed)(e)&&!(0,t.isWatcher)(e))throw new TypeError("Called introspectSources without a Computed or Watcher argument");return(null==(n=e[Ie].producerNode)?void 0:n.map((t=>t.wrapper)))??[]},e.introspectSinks=function(e){var n;if(!(0,t.isComputed)(e)&&!(0,t.isState)(e))throw new TypeError("Called introspectSinks without a Signal argument");return(null==(n=e[Ie].liveConsumerNode)?void 0:n.map((t=>t.wrapper)))??[]},e.hasSinks=function(e){if(!(0,t.isComputed)(e)&&!(0,t.isState)(e))throw new TypeError("Called hasSinks without a Signal argument");const n=e[Ie].liveConsumerNode;return!!n&&n.length>0},e.hasSources=function(e){if(!(0,t.isComputed)(e)&&!(0,t.isWatcher)(e))throw new TypeError("Called hasSources without a Computed or Watcher argument");const n=e[Ie].producerNode;return!!n&&n.length>0};n=Ie,s=new WeakSet,i=new WeakSet,o=function(e){for(const n of e)if(!(0,t.isComputed)(n)&&!(0,t.isState)(n))throw new TypeError("Called watch/unwatch without a Computed or State argument")},t.isWatcher=t=>oe(s,t),e.Watcher=class{constructor(t){re(this,s),re(this,i),ie(this,n);let e=Object.create(ge);e.wrapper=this,e.consumerMarkedDirty=t,e.consumerIsAlwaysLive=!0,e.consumerAllowSignalWrites=!1,e.producerNode=[],this[Ie]=e}watch(...e){if(!(0,t.isWatcher)(this))throw new TypeError("Called unwatch without Watcher receiver");ae(this,i,o).call(this,e);const n=this[Ie];n.dirty=!1;const s=pe(n);for(const t of e)me(t[Ie]);pe(s)}unwatch(...e){if(!(0,t.isWatcher)(this))throw new TypeError("Called unwatch without Watcher receiver");ae(this,i,o).call(this,e);const n=this[Ie];we(n);for(let t=n.producerNode.length-1;t>=0;t--)if(e.includes(n.producerNode[t].wrapper)){_e(n.producerNode[t],n.producerIndexOfThis[t]);const e=n.producerNode.length-1;if(n.producerNode[t]=n.producerNode[e],n.producerIndexOfThis[t]=n.producerIndexOfThis[e],n.producerNode.length--,n.producerIndexOfThis.length--,n.nextProducerIndex--,t<n.producerNode.length){const e=n.producerIndexOfThis[t],s=n.producerNode[t];$e(s),s.liveConsumerIndexOfThis[e]=t}}}getPending(){if(!(0,t.isWatcher)(this))throw new TypeError("Called getPending without Watcher receiver");return this[Ie].producerNode.filter((t=>t.dirty)).map((t=>t.wrapper))}},e.currentComputed=function(){var t;return null==(t=ce)?void 0:t.wrapper},e.watched=Symbol("watched"),e.unwatched=Symbol("unwatched")})(t.subtle||(t.subtle={}))})(Me||(Me={}));
/**
 * @license
 * Copyright 2023 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const je=Symbol("SignalWatcherBrand"),Re=new FinalizationRegistry((({watcher:t,signal:e})=>{t.unwatch(e)})),Le=new WeakMap;function De(t){return!0===t[je]?(console.warn("SignalWatcher should not be applied to the same class more than once."),t):class extends t{constructor(){super(...arguments),this._$St=new Me.State(0),this._$Si=!1,this._$So=!0,this._$Sh=new Set}_$Sl(){if(void 0!==this._$Su)return;this._$Sv=new Me.Computed((()=>{this._$St.get(),super.performUpdate()}));const t=this._$Su=new Me.subtle.Watcher((function(){const t=Le.get(this);void 0!==t&&(!1===t._$Si&&t.requestUpdate(),this.watch())}));Le.set(t,this),Re.register(this,{watcher:t,signal:this._$Sv}),t.watch(this._$Sv)}_$Sp(){void 0!==this._$Su&&(this._$Su.unwatch(this._$Sv),this._$Sv=void 0,this._$Su=void 0)}performUpdate(){this.isUpdatePending&&(this._$Sl(),this._$Si=!0,this._$St.set(this._$St.get()+1),this._$Si=!1,this._$Sv.get())}update(t){try{this._$So?(this._$So=!1,super.update(t)):this._$Sh.forEach((t=>t.commit()))}finally{this.isUpdatePending=!1,this._$Sh.clear()}}requestUpdate(t,e,n){this._$So=!0,super.requestUpdate(t,e,n)}connectedCallback(){super.connectedCallback(),this.requestUpdate()}disconnectedCallback(){super.disconnectedCallback(),queueMicrotask((()=>{!1===this.isConnected&&this._$Sp()}))}_(t){this._$Sh.add(t);const e=this._$So;this.requestUpdate(),this._$So=e}m(t){this._$Sh.delete(t)}}}const Ue=Ot(
/**
 * @license
 * Copyright 2023 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
class extends Zt{_$Sl(){if(void 0!==this._$Su)return;this._$SW=new Me.Computed((()=>{var t;return null===(t=this._$Sj)||void 0===t?void 0:t.get()}));const t=this._$Su=new Me.subtle.Watcher((()=>{var e;null===(e=this._$SO)||void 0===e||e._(this),t.watch()}));t.watch(this._$SW)}_$Sp(){var t;void 0!==this._$Su&&(this._$Su.unwatch(this._$SW),this._$SW=void 0,this._$Su=void 0,null===(t=this._$SO)||void 0===t||t.m(this))}commit(){this.setValue(Me.subtle.untrack((()=>{var t;return null===(t=this._$SW)||void 0===t?void 0:t.get()})))}render(t){return Me.subtle.untrack((()=>t.get()))}update(t,[e]){var n,s;return null!==(n=this._$SO)&&void 0!==n||(this._$SO=null===(s=t.options)||void 0===s?void 0:s.host),e!==this._$Sj&&void 0!==this._$Sj&&this._$Sp(),this._$Sj=e,this._$Sl(),Me.subtle.untrack((()=>this._$SW.get()))}disconnected(){this._$Sp()}reconnected(){this._$Sl()}}),He=t=>(e,...n)=>t(e,...n.map((t=>t instanceof Me.State||t instanceof Me.Computed?Ue(t):t))),We=(He(ct),He(dt),Me.State,Me.Computed,(t,e)=>new Me.State(t,e)),qe="important",ze=" !"+qe,Be=Ot(class extends It{constructor(t){if(super(t),t.type!==Tt||"style"!==t.name||t.strings?.length>2)throw Error("The `styleMap` directive must be used in the `style` attribute and must be the only part in the attribute.")}render(t){return Object.keys(t).reduce(((e,n)=>{const s=t[n];return null==s?e:e+`${n=n.includes("-")?n:n.replace(/(?:^(webkit|moz|ms|o)|)(?=[A-Z])/g,"-$&").toLowerCase()}:${s};`}),"")}update(t,[e]){const{style:n}=t.element;if(void 0===this.ft)return this.ft=new Set(Object.keys(e)),this.render(e);for(const t of this.ft)null==e[t]&&(this.ft.delete(t),t.includes("-")?n.removeProperty(t):n[t]=null);for(const t in e){const s=e[t];if(null!=s){this.ft.add(t);const e="string"==typeof s&&s.endsWith(ze);t.includes("-")||e?n.setProperty(t,e?s.slice(0,-11):s,e?qe:""):n[t]=s}}return ht}});const Ge=(t=>{var e={};return o.d(e,t),e})({extension_settings:()=>i.extension_settings});var Ke;const Ve="extension-zerxz-lib",Ye="scripts/extensions/third-party/".concat(Ve);null!==(Ke=Ge.extension_settings[Ve])&&void 0!==Ke||(Ge.extension_settings[Ve]={});const Fe={},Qe=Ge.extension_settings[Ve],Je=()=>Ge.extension_settings;const Ze=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;var n,s;t&&(null!==(n=Qe[t])&&void 0!==n||(Qe[t]={}),null!==(s=Fe[t])&&void 0!==s||(Fe[t]={}));const i=t?Qe[t]:Qe;if(e){const t="function"==typeof e?e():e;for(const e in t){var o;null!==(o=i[e])&&void 0!==o||(i[e]=t[e])}(0,r.saveSettingsDebounced)()}const a=t?Fe[t]:Fe;for(const t in i){var l;null!==(l=a[t])&&void 0!==l||(a[t]=d(t,i[t]))}function c(t,e){i[t]=e,(0,r.saveSettingsDebounced)()}function d(t,e,n){return{rawSignal:We(e,n),get(){return this.rawSignal.get()},set(e){this.rawSignal.set(e),c(t,e)}}}return(0,r.saveSettingsDebounced)(),{getExtensionSettings:Je,extensionSettings:i,setSetting:c,getSetting:function(t){return i[t]},setSettings:function(t){Object.assign(i,t),(0,r.saveSettingsDebounced)()},getSettings:function(){return i},saveSettingsDebounced:r.saveSettingsDebounced,extensionFolderPath:Ye,getSignal:function(t){var e,n;return null!==(n=a[e=t])&&void 0!==n||(a[e]=d(t,i[t])),a[t]},getSignals:function(){return a}}}("HtmlInjector",(()=>({lastMesTextContent:localStorage.getItem("lastMesTextContent")||"",isInjectionEnabled:JSON.parse(localStorage.getItem("isInjectionEnabled")||"true"),displayMode:Number.parseInt(localStorage.getItem("displayMode")||"1"),activationMode:localStorage.getItem("activationMode")||"all",customStartFloor:Number.parseInt(localStorage.getItem("customStartFloor")||"1"),customEndFloor:Number.parseInt(localStorage.getItem("customEndFloor")||"-1"),savedPosition:localStorage.getItem("edgeControlsPosition")||"top-right",isEdgeControlsCollapsed:JSON.parse(localStorage.getItem("isEdgeControlsCollapsed")||"true"),isVisibleSettingsPanel:JSON.parse(localStorage.getItem("isVisibleSettingsPanel")||"true"),saveTopPosition:localStorage.getItem("saveTopPosition")||"",hiddenEdgeControls:!1})));var Xe,tn,en,nn;function sn(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,s)}return n}function on(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?sn(Object(n),!0).forEach((function(e){an(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):sn(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function rn(t,e){return e||(e=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}function an(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var s=n.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const{saveSettingsDebounced:ln,extensionSettings:cn,setSetting:dn,getSettings:hn,getSignals:un}=Ze;const{lastMesTextContent:pn,isInjectionEnabled:gn,displayMode:mn,activationMode:fn,customStartFloor:vn,customEndFloor:yn,savedPosition:bn,isEdgeControlsCollapsed:_n,isVisibleSettingsPanel:Sn,saveTopPosition:wn,hiddenEdgeControls:$n}=un(),An=$("#chat"),xn=new MutationObserver((t=>{let e=!1;for(const n of t){if("childList"!==n.type)continue;if(Array.from(n.addedNodes).some((t=>t.nodeType===Node.ELEMENT_NODE&&t instanceof HTMLElement&&(t.classList.contains("mes_text")||t.querySelector(".mes_text"))))){gn.get()&&(e=!0);break}}e&&(Cn(),kn())}));class En{constructor(){an(this,"resizeObservers",new Map)}static getInstance(){return En.instance||(En.instance=new En),En.instance}createIframe(t){const e=document.createElement("iframe");return this.setupIframeAttributes(e),e.srcdoc=this.getIframeSrcContent(t),this.setupIframeEventListeners(e),e}setupIframeAttributes(t){Object.assign(t.style,{width:"100%",border:"none",marginTop:"10px",transition:"height 0.3s ease"})}setupIframeEventListeners(t){if(t.onload=()=>{this.adjustIframeHeight(t),setTimeout((()=>this.adjustIframeHeight(t)),500),this.updateIframeTheme(t,Pn())},t.contentWindow){const e=new ResizeObserver((()=>this.adjustIframeHeight(t)));this.resizeObservers.set(t,e),t.addEventListener("load",(()=>{var n;null!==(n=t.contentWindow)&&void 0!==n&&n.document.body&&e.observe(t.contentWindow.document.body)}))}}adjustIframeHeight(t){try{var e;if(null!==(e=t.contentWindow)&&void 0!==e&&e.document.body){const e=Math.max(t.contentWindow.document.documentElement.scrollHeight,t.contentWindow.document.body.scrollHeight);t.style.height="".concat(e+5,"px")}}catch(t){console.error("调整iframe高度失败:",t)}}updateIframeTheme(t,e){try{var n;null===(n=t.contentWindow)||void 0===n||n.postMessage({type:"themeChange",theme:e},"*")}catch(t){console.error("更新iframe主题失败:",t)}}removeIframe(t){const e=this.resizeObservers.get(t);e&&(e.disconnect(),this.resizeObservers.delete(t)),t.remove()}getIframeSrcContent(t){return'\n            <html>\n    <head>\n        <style>\n            /* 自定义样式 */\n            ::-webkit-scrollbar {\n                width: 8px;\n                height: 8px;\n            }\n            ::-webkit-scrollbar-track {\n                background: rgba(0, 0, 0, 0.1);\n                border-radius: 4px;\n            }\n            ::-webkit-scrollbar-thumb {\n                background: rgba(0, 0, 0, 0.3);\n                border-radius: 4px;\n            }\n            ::-webkit-scrollbar-thumb:hover {\n                background: rgba(0, 0, 0, 0.5);\n            }\n            [data-theme="dark"] ::-webkit-scrollbar-track {\n                background: rgba(255, 255, 255, 0.1);\n            }\n            [data-theme="dark"] ::-webkit-scrollbar-thumb {\n                background: rgba(255, 255, 255, 0.3);\n            }\n            [data-theme="dark"] ::-webkit-scrollbar-thumb:hover {\n                background: rgba(255, 255, 255, 0.5);\n            }\n            .container[data-theme="light"] {\n                --bg-color: rgba(240, 240, 255, 0.1);\n                --text-color: #1e1e1e;\n                --border-color: rgba(139,226,115,0.3);\n                --nav-bg-color: rgba(240,240,255,0.4);\n            }\n            .container[data-theme="dark"] {\n                --bg-color: rgba(40, 40, 40, 0.2);\n                --text-color: #e0e0e0;\n                --border-color: rgba(74,74,74,0.3);\n                --nav-bg-color: rgba(30,30,30,0.4);\n            }\n            .container {\n                background-color: var(--bg-color);\n                color: var(--text-color);\n            }\n            .container .left-nav {\n                background-color: var(--nav-bg-color);\n            }\n            .container .button, .container .left-nav .section {\n                border: 1px solid var(--border-color);\n            }\n        </style>\n    </head>\n    <body>\n        <div class="theme-content">\n            '.concat(t,"\n        </div>\n        <script>\n            window.addEventListener('load', function() {\n                window.parent.postMessage('loaded', '*');\n                const darkModeMediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\n                function handleThemeChange(e) {\n                    document.body.setAttribute('data-theme', e.matches ? 'dark' : 'light');\n                    window.parent.postMessage({type: 'themeChange', theme: e.matches ? 'dark' : 'light'}, '*');\n                }\n                darkModeMediaQuery.addListener(handleThemeChange);\n                handleThemeChange(darkModeMediaQuery);\n                document.querySelectorAll('.qr-button').forEach(button => {\n                    button.addEventListener('click', function() {\n                        const buttonName = this.textContent.trim();\n                        window.parent.postMessage({type: 'buttonClick', name: buttonName}, '*');\n                    });\n                });\n                document.querySelectorAll('.st-text').forEach(textarea => {\n                    textarea.addEventListener('input', function() {\n                        window.parent.postMessage({type: 'textInput', text: this.value}, '*');\n                    });\n                    textarea.addEventListener('change', function() {\n                        window.parent.postMessage({type: 'textInput', text: this.value}, '*');\n                    });\n                    const observer = new MutationObserver((mutations) => {\n                        mutations.forEach((mutation) => {\n                            if (mutation.type === 'attributes' && mutation.attributeName === 'value') {\n                                window.parent.postMessage({type: 'textInput', text: textarea.value}, '*');\n                            }\n                        });\n                    });\n                    observer.observe(textarea, { attributes: true });\n                });\n                document.querySelectorAll('.st-send-button').forEach(button => {\n                    button.addEventListener('click', function() {\n                        window.parent.postMessage({type: 'sendClick'}, '*');\n                    });\n                });\n            });\n            window.addEventListener('message', function(event) {\n                if (event.data.type === 'themeChange') {\n                    document.body.setAttribute('data-theme', event.data.theme);\n                }\n            });\n        <\/script>\n    </body>\n</html>\n        ")}}function Cn(){const t=En.getInstance(),e=document.querySelectorAll(".mes_text iframe");for(const n of Array.from(e))t.removeIframe(n);const n=document.querySelectorAll(".mes_text code");for(const t of Array.from(n)){t.style.display="";const e=t.closest("details");var s;if(e)null===(s=e.parentNode)||void 0===s||s.insertBefore(t,e),e.remove()}}function kn(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;console.log("injectHtmlCode");try{const s=t?[t]:Array.from(An.find(".mes_text"));let i;const o=En.getInstance();switch(fn.get()){case"first":i=s.slice(0,1);break;case"last":i=s.slice(-1);break;case"lastN":i=s.slice(-yn);break;case"custom":{const t=vn.get()-1,e=-1===yn.get()?void 0:yn.get();i=s.slice(t,e);break}default:i=s}for(let t=0;t<i.length;t++){var e;const s=i[t],r=s.querySelector("code");if(!r)continue;const a=r.innerText.trim();if(!a.startsWith("<")||!a.endsWith(">"))continue;const l=o.createIframe(a);if(2===mn.get()){var n;const t=document.createElement("details"),e=document.createElement("summary");e.textContent="[原代码]",t.appendChild(e),null===(n=r.parentNode)||void 0===n||n.insertBefore(t,r),t.appendChild(r)}else 3===mn.get()&&(r.style.display="none");null===(e=r.parentNode)||void 0===e||e.insertBefore(l,r.nextSibling),s.appendChild(l)}}catch(t){console.error("HTML注入失败:",t)}}function Pn(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function Tn(){document.querySelectorAll(".mes_text iframe").forEach((t=>{try{t.contentWindow&&t.contentWindow.postMessage({type:"themeChange",theme:Pn()},"*")}catch(t){console.error("更新iframe主题失败:",t)}}))}function Nn(t){try{if("loaded"===t.data){document.querySelectorAll(".mes_text iframe").forEach((e=>{e.contentWindow===t.source&&function(t){try{var e;if(null!==(e=t.contentWindow)&&void 0!==e&&e.document.body){const e=t.contentWindow.document.documentElement.scrollHeight;t.style.height="".concat(e+5,"px")}}catch(t){console.error("调整iframe高度失败:",t)}}(e)}))}else if("buttonClick"===t.data.type){const e=t.data.name;jQuery(".qr--button.menu_button").each((function(){if(jQuery(this).find(".qr--button-label").text().trim()===e)return jQuery(this).trigger("click"),!1}))}else if("textInput"===t.data.type){const e=document.getElementById("send_textarea");e&&(e.value=t.data.text,e.dispatchEvent(new Event("input",{bubbles:!0})),e.dispatchEvent(new Event("change",{bubbles:!0})))}else if("sendClick"===t.data.type){const t=document.getElementById("send_but");t&&t.click()}}catch(t){console.error("处理消息失败:",t)}}an(En,"instance",void 0);class On extends(De(kt)){constructor(){super(...arguments),an(this,"customFloorSettingsRef",Xt()),an(this,"LastSettingsRef",Xt())}createRenderRoot(){return this}render(){return this.style.display=Sn.get()?"none":"block",this.classList.add("drawer"),ct(Xe||(Xe=rn(['\n        <div id="html-injector-settings-header" class="inline-drawer-header">\n                <span class="inline-drawer-title">HTML注入器设置</span>\n                <div id="html-injector-close-settings" class="inline-drawer-icon fa-solid fa-circle-xmark" @click=','></div>\n            </div>\n            <div id="settings-content">\n                <div class="settings-section">\n                    <h3 class="settings-subtitle">边缘控制面板位置</h3>\n                <select id="edge-controls-position" class="settings-select theme-element" @change=','>\n                    <option value="top-right"            .selected=','>界面右上角</option>\n                    <option value="right-three-quarters" .selected=','>界面右侧3/4位置</option>\n                    <option value="right-middle"         .selected=','>界面右侧中间</option>\n                    <option value="top-left"             .selected=','>界面左上角</option>\n                    <option value="left-three-quarters"  .selected=','>界面左侧3/4位置</option>\n                    <option value="left-middle"          .selected=','>界面左侧中间</option>\n                    <option value="custom"               .selected=','>自定义位置</option>\n                    <option value="hidden"               .selected=','>隐藏</option>\n\n                </select>\n                </div>\n                <div class="settings-section">\n                <h3 class="settings-subtitle">显示模式</h3>\n                <label class="settings-option"><input type="radio" name="display-mode" value="1" .checked='," @change=",'> 原代码和注入效果一起显示</label>\n                <label class="settings-option"><input type="radio" name="display-mode" value="2" .checked='," @change=",'> 原代码以摘要形式显示</label>\n                <label class="settings-option"><input type="radio" name="display-mode" value="3" .checked='," @change=",'> 隐藏原代码，只显示注入效果</label>\n            </div>\n                <div class="settings-section">\n                    <h3 class="settings-subtitle">激活楼层</h3>\n                    <select id="activation-mode" class="settings-select theme-element" @change=',' >\n                        <option value="all"    .selected=','>全部楼层</option>\n                        <option value="first"  .selected=','>第一层</option>\n                        <option value="last"   .selected=','>最后一层</option>\n                        <option value="lastN"  .selected=','>最后N层</option>\n                        <option value="custom" .selected=','>自定义楼层</option>\n                    </select>\n                    <div id="custom-floor-settings" class="settings-subsection" style='," ",'>\n                        <label class="settings-option">起始楼层: <input type="number" id="custom-start-floor" min="1" .value='," @change=",'></label>\n                        <label class="settings-option">结束楼层: <input type="number" id="custom-end-floor" min="-1" .value='," @change=",'></label>\n                        <p class="settings-note">（-1 表示最后一层）</p>\n                    </div>\n                    <div id="last-n-settings" class="settings-subsection" style='," ",' >\n                        <label class="settings-option">最后 <input type="number" id="last-n-floors" min="1" .value=',"  @change=",'> 层</label>\n                    </div>\n                </div>\n            </div>\n            <div class="settings-footer">\n                <p>安全提醒：请仅注入您信任的代码。不安全的代码可能会对您的系统造成潜在风险。</p>\n                <p>注意：要注入的 HTML 代码应该用 ``` 包裹，例如：</p>\n                <pre class="code-example">\n```\n&lt;h1&gt;Hello, World!&lt;/h1&gt;\n&lt;p&gt;This is an example.&lt;/p&gt;\n```\n        </pre>\n        <p>以下是对应ST酒馆功能的特殊类名及简单的使用方法：</p>\n        <pre class="code-example">\n```\n&lt;button class="qr-button"&gt;(你的QR按钮名字)&lt;/button&gt;\n&lt;textarea class="st-text"&gt;(对应酒馆的输入文本框，输入内容会同步到酒馆的文本框里)&lt;/textarea&gt;\n&lt;button class="st-send-button"&gt;(对应酒馆的发送按钮)&lt;/button&gt;\n```\n                </pre>\n                <p>【注意】通过JavaScript动态插入st-text框的内容同步到st酒馆的输入框需要处理时间，如果需要同步，请添加一个小延迟来确保文本有时间进行同步.</p>\n                <a href="https://discord.com/channels/1134557553011998840/1271783456690409554" target="_blank"> →Discord教程帖指路← 有详细说明与gal界面等模版 </a>\n            </div>\n        '],['\n        <div id="html-injector-settings-header" class="inline-drawer-header">\n                <span class="inline-drawer-title">HTML注入器设置</span>\n                <div id="html-injector-close-settings" class="inline-drawer-icon fa-solid fa-circle-xmark" @click=','></div>\n            </div>\n            <div id="settings-content">\n                <div class="settings-section">\n                    <h3 class="settings-subtitle">边缘控制面板位置</h3>\n                <select id="edge-controls-position" class="settings-select theme-element" @change=','>\n                    <option value="top-right"            .selected=','>界面右上角</option>\n                    <option value="right-three-quarters" .selected=','>界面右侧3/4位置</option>\n                    <option value="right-middle"         .selected=','>界面右侧中间</option>\n                    <option value="top-left"             .selected=','>界面左上角</option>\n                    <option value="left-three-quarters"  .selected=','>界面左侧3/4位置</option>\n                    <option value="left-middle"          .selected=','>界面左侧中间</option>\n                    <option value="custom"               .selected=','>自定义位置</option>\n                    <option value="hidden"               .selected=','>隐藏</option>\n\n                </select>\n                </div>\n                <div class="settings-section">\n                <h3 class="settings-subtitle">显示模式</h3>\n                <label class="settings-option"><input type="radio" name="display-mode" value="1" .checked='," @change=",'> 原代码和注入效果一起显示</label>\n                <label class="settings-option"><input type="radio" name="display-mode" value="2" .checked='," @change=",'> 原代码以摘要形式显示</label>\n                <label class="settings-option"><input type="radio" name="display-mode" value="3" .checked='," @change=",'> 隐藏原代码，只显示注入效果</label>\n            </div>\n                <div class="settings-section">\n                    <h3 class="settings-subtitle">激活楼层</h3>\n                    <select id="activation-mode" class="settings-select theme-element" @change=',' >\n                        <option value="all"    .selected=','>全部楼层</option>\n                        <option value="first"  .selected=','>第一层</option>\n                        <option value="last"   .selected=','>最后一层</option>\n                        <option value="lastN"  .selected=','>最后N层</option>\n                        <option value="custom" .selected=','>自定义楼层</option>\n                    </select>\n                    <div id="custom-floor-settings" class="settings-subsection" style='," ",'>\n                        <label class="settings-option">起始楼层: <input type="number" id="custom-start-floor" min="1" .value='," @change=",'></label>\n                        <label class="settings-option">结束楼层: <input type="number" id="custom-end-floor" min="-1" .value='," @change=",'></label>\n                        <p class="settings-note">（-1 表示最后一层）</p>\n                    </div>\n                    <div id="last-n-settings" class="settings-subsection" style='," ",' >\n                        <label class="settings-option">最后 <input type="number" id="last-n-floors" min="1" .value=',"  @change=",'> 层</label>\n                    </div>\n                </div>\n            </div>\n            <div class="settings-footer">\n                <p>安全提醒：请仅注入您信任的代码。不安全的代码可能会对您的系统造成潜在风险。</p>\n                <p>注意：要注入的 HTML 代码应该用 \\`\\`\\` 包裹，例如：</p>\n                <pre class="code-example">\n\\`\\`\\`\n&lt;h1&gt;Hello, World!&lt;/h1&gt;\n&lt;p&gt;This is an example.&lt;/p&gt;\n\\`\\`\\`\n        </pre>\n        <p>以下是对应ST酒馆功能的特殊类名及简单的使用方法：</p>\n        <pre class="code-example">\n\\`\\`\\`\n&lt;button class="qr-button"&gt;(你的QR按钮名字)&lt;/button&gt;\n&lt;textarea class="st-text"&gt;(对应酒馆的输入文本框，输入内容会同步到酒馆的文本框里)&lt;/textarea&gt;\n&lt;button class="st-send-button"&gt;(对应酒馆的发送按钮)&lt;/button&gt;\n\\`\\`\\`\n                </pre>\n                <p>【注意】通过JavaScript动态插入st-text框的内容同步到st酒馆的输入框需要处理时间，如果需要同步，请添加一个小延迟来确保文本有时间进行同步.</p>\n                <a href="https://discord.com/channels/1134557553011998840/1271783456690409554" target="_blank"> →Discord教程帖指路← 有详细说明与gal界面等模版 </a>\n            </div>\n        '])),this.toggleSettingsPanel,this.handleSavePositionChange,"top-right"===bn.get(),"right-three-quarters"===bn.get(),"right-middle"===bn.get(),"top-left"===bn.get(),"left-three-quarters"===bn.get(),"left-middle"===bn.get(),"custom"===bn.get(),"hidden"===bn.get(),1===mn.get(),this.handleDisplayModeChange,2===mn.get(),this.handleDisplayModeChange,3===mn.get(),this.handleDisplayModeChange,this.handleActivationModeChange,"all"===fn.get(),"first"===fn.get(),"last"===fn.get(),"lastN"===fn.get(),"custom"===fn.get(),Be({display:"custom"===fn.get()?"block":"none"}),ne(this.customFloorSettingsRef),vn.get().toString(),this.handleCustomStartFloorChange,yn.get().toString(),this.handleCustomEndFloorChange,Be({display:"lastN"===fn.get()?"block":"none"}),ne(this.LastSettingsRef),yn.get().toString(),this.handleLastNFloorsChange)}handleActivationModeChange(t){const e=t.target.value;fn.set(e),this.updateInjection()}handleSavePositionChange(t){const e=t.target.value;bn.set(e),_n.set(!1),this.edgeControls.updateEdgeControlsPosition(e)}handleCustomStartFloorChange(t){const e=t.target,n=Number.parseInt(e.value);vn.set(n),this.updateInjection()}handleCustomEndFloorChange(t){const e=t.target,n=Number.parseInt(e.value);yn.set(n),this.updateInjection()}handleLastNFloorsChange(t){const e=t.target,n=Number.parseInt(e.value);yn.set(n),this.updateInjection()}handleDisplayModeChange(t){const e=t.target,n=Number.parseInt(e.value);mn.set(n),this.updateInjection()}toggleSettingsPanel(t){const e="block"===this.style.display;this.style.display=e?"block":"node",Sn.set(e)}updateInjection(){gn.get()&&(Cn(),kn())}}class In extends(De(kt)){constructor(){super(),an(this,"newTop",void 0);const t=bn.get().includes("left");this.toggleEdgeButtonStyle=on({position:"absolute",top:"50%",transform:"translateY(-50%)",backgroundColor:"var(--SmartThemeBlurTintColor, rgba(22, 11, 18, 0.73))",color:"var(--SmartThemeBodyColor, rgba(220, 220, 210, 1))",border:"1px solid var(--SmartThemeBorderColor, rgba(217, 90, 157, 0.5))",cursor:"pointer",padding:"5px",userSelect:"none",fontSize:"12px",height:"60px",width:"20px",textAlign:"center"},t?{right:"-20px",left:"auto",borderRadius:"0 5px 5px 0"}:{left:"-20px",right:"auto",borderRadius:"5px 0 0 5px"}),this.isDragging=!1,this.startY=0,this.startTop=0,this.newTop=0}createRenderRoot(){return this}connectedCallback(){super.connectedCallback(),document.addEventListener("mousemove",this.handleDragMove.bind(this)),document.addEventListener("mouseup",this.handleDragEnd.bind(this)),document.addEventListener("touchmove",this.handleDragMove.bind(this)),document.addEventListener("touchend",this.handleDragEnd.bind(this))}disconnectedCallback(){super.disconnectedCallback(),document.removeEventListener("mousemove",this.handleDragMove.bind(this)),document.removeEventListener("mouseup",this.handleDragEnd.bind(this)),document.removeEventListener("touchmove",this.handleDragMove.bind(this)),document.removeEventListener("touchend",this.handleDragEnd.bind(this))}render(){console.log("render edge controls"),console.log("isInjectionEnabled",gn.get()),console.log("isVisibleSettingsPanel",Sn.get());return bn.get().includes("left")?(this.style.left=_n.get()?"-100px":"0",this.style.right="auto"):(this.style.right=_n.get()?"-100px":"0",this.style.left="auto"),this.style.display=$n.get()?"none":"block",ct(tn||(tn=rn(['\n            <div id="html-injector-drag-handle" @mousedown='," @touchstart=",'>\n                <div class="drag-dots">\n                ','\n                </div>\n            </div>\n            <label class="html-injector-switch">\n                <input type="checkbox" id="edge-injection-toggle" @change='," .checked=",'>\n                <span class="html-injector-slider"></span>\n            </label>\n            <button id="html-injector-toggle-panel" class="html-injector-button menu_button" @click=',">",'</button>\n            <button id="toggle-edge-controls" style=',"\n            @click=","\n            >\n            ","\n            </button>\n"])),this.handleDragStart,this.handleDragStart,Array.from({length:3}).map((()=>ct(en||(en=rn(['\n                    <div style="display: flex; flex-direction: column; justify-content: space-between; height: 15px;">\n                        ',"\n                    </div>\n                "])),Array.from({length:2}).map((()=>ct(nn||(nn=rn(['\n                            <div style="width: 4px; height: 4px; border-radius: 50%; background-color: var(--smart-theme-body-color);"></div>\n                        '])))))))),this.handleToggleChange,gn.get(),this.toggleSettingsPanel,Sn.get()?"显示面板":"隐藏面板",Be(this.toggleEdgeButtonStyle),this.handleToggleEdgeControls,_n.get()?"<<":">>")}handleDragStart(t){this.isDragging=!0,this.startY=t.type.includes("mouse")?t.clientY:t.touches[0].clientY,this.startTop=this.getBoundingClientRect().top,t.preventDefault()}handleDragMove(t){if(!this.isDragging)return;const e=t.type.includes("mouse")?t.clientY:t.touches[0].clientY;let n=this.startTop+(e-this.startY);n=Math.max(0,Math.min(n,window.innerHeight-this.offsetHeight)),this.newTop=n,this.style.top="".concat(n,"px")}handleDragEnd(t){this.isDragging=!1,"custom"===fn.get()&&wn.set(this.newTop.toString())}handleToggleEdgeControls(t){_n.set(!_n.get());const e=_n.get(),n=bn.get().includes("left"),s=t.target;n?(this.style.left=e?"-100px":"0",this.style.right="auto",s.textContent=e?">>":"<<"):(this.style.right=e?"-100px":"0",this.style.left="auto",s.textContent=e?"<<":">>"),this.toggleEdgeButtonStyle=on(on({},this.toggleEdgeButtonStyle),n?{right:"-20px",left:"auto",borderRadius:"0 5px 5px 0"}:{left:"-20px",right:"auto",borderRadius:"5px 0 0 5px"})}handleToggleChange(t){const e=t.target.checked;console.log("isEnabled",e),gn.set(e),e?kn():Cn()}toggleSettingsPanel(t){this.settingsPanel.toggleSettingsPanel(t)}updatePosition(){this.updateEdgeControlsPosition(bn.get())}updateEdgeControlsPosition(t){const e=t.includes("left");switch(e?this.classList.add("left-side"):this.classList.remove("left-side"),t){case"top-right":case"top-left":this.style.top="20vh",this.style.transform="none";break;case"right-three-quarters":case"left-three-quarters":this.style.top="75vh",this.style.transform="none";break;case"right-middle":case"left-middle":this.style.top="50%",this.style.transform="translateY(-50%)";break;case"custom":this.style.top=wn.get()?"".concat(wn.get(),"px"):"20vh",this.style.transform="none"}e?(this.style.left=_n.get()?"-100px":"0",this.style.right="auto"):(this.style.right=_n.get()?"-100px":"0",this.style.left="auto"),this.toggleEdgeButtonStyle=on(on({},this.toggleEdgeButtonStyle),e?{right:"-20px",left:"auto",borderRadius:"0 5px 5px 0"}:{left:"-20px",right:"auto",borderRadius:"5px 0 0 5px"}),this.requestUpdate()}}an(In,"properties",{settingsPanel:{type:Object},toggleEdgeButtonStyle:{type:Object},isDragging:{type:Boolean},startY:{type:Number},startTop:{type:Number},newTop:{type:Number}}),customElements.define("settings-panel",On),customElements.define("edge-controls",In);
/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const Mn=Ot(class extends It{constructor(t){if(super(t),t.type!==Tt||"class"!==t.name||t.strings?.length>2)throw Error("`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.")}render(t){return" "+Object.keys(t).filter((e=>t[e])).join(" ")+" "}update(t,[e]){if(void 0===this.st){this.st=new Set,void 0!==t.strings&&(this.nt=new Set(t.strings.join(" ").split(/\s/).filter((t=>""!==t))));for(const t in e)e[t]&&!this.nt?.has(t)&&this.st.add(t);return this.render(e)}const n=t.element.classList;for(const t of this.st)t in e||(n.remove(t),this.st.delete(t));for(const t in e){const s=!!e[t];s===this.st.has(t)||this.nt?.has(t)||(s?(n.add(t),this.st.add(t)):(n.remove(t),this.st.delete(t)))}return ht}});var jn;const{hiddenEdgeControls:Rn}=Ze.getSignals();customElements.define("zerxz-lib-container",class extends kt{createRenderRoot(){return this}render(){return ct(jn||(jn=function(t,e){return e||(e=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}(['\n    <div class="zerxz-lib-settings">\n        <div class="inline-drawer">\n            <div class="inline-drawer-toggle inline-drawer-header">\n                <b>ZerxzLib</b>\n                <div class="inline-drawer-icon fa-solid fa-circle-chevron-down down"></div>\n            </div>\n            <div class="inline-drawer-content" >\n    <div class="flex-container" >\n        <div class="menu_button menu_button_icon interactable" @click=',">\n            <i class="," ></i>\n            <small >","注入面板</small>\n        </div>\n    </div>\n    <hr>\n</div>\n        </div>\n    </div>\n    "])),this.handlerHiddenEdgeControl,Mn({"fa-solid":!0,"fa-bug":Rn.get(),"fa-bug-slash":!Rn.get()}),Rn.get()?"显示":"隐藏")}handlerHiddenEdgeControl(){Rn.set(!Rn.get()),this.requestUpdate()}}),(async(t,e)=>{toastr.error=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(b(...e),console.log(e),console.error(...e),!f()||!d.throwGeminiErrorState)return;const[s,i]=e;if(i&&"Chat Completion API"===i){const t=$("#last_key_maker_suite")[0];v("<h3>Chat Completion API 错误</h3>\n\t\t\t\t<p>".concat(s,"</p>\n\t\t\t\t<p> ").concat(t.textContent,"</p>"))}},function(){const t=document.createElement("settings-panel"),e=document.createElement("edge-controls");t.id="html-injector-settings",e.id="html-injector-edge-controls",t.edgeControls=e,e.settingsPanel=t;const n=bn.get();n.includes("left")&&e.classList.add("left-side"),document.body.appendChild(t),document.body.appendChild(e),e.updateEdgeControlsPosition(n),window.addEventListener("resize",(()=>{e.updatePosition()})),window.addEventListener("message",Nn),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",Tn),xn.observe(document.body,{childList:!0,subtree:!0})}(),function(){const t=document.createElement("zerxz-lib-container");t.className="extension_container",t.id="zerxzlib_container";const e=document.getElementById("extensions_settings2");e&&e.appendChild(t)}();const n=null!==(t=await u())&&void 0!==t?t:{};await y(n);const s=$("#makersuite_form")[0];console.log("secrets",n);const i=document.createElement("gemini-layouts");i.currentKey=n.api_key_makersuite,i.lastKey=(null===(e=n[c])||void 0===e?void 0:e.split("\n").pop())||"",i.throwGeminiErrorState=d.throwGeminiErrorState,i.switchKeyMakerSuite=d.switchState,i.apiKeys=n[c]||"",s.appendChild(i),r.eventSource.on(r.event_types.CHAT_COMPLETION_SETTINGS_READY,p),r.eventSource.on(r.event_types.CHATCOMPLETION_MODEL_CHANGED,(async t=>{f()&&await g("api_key_makersuite_model",t)}))})();
//# sourceMappingURL=zerxzLib.js.map